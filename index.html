<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StepBeyond - Career Counseling Assistant</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 40px;
            padding: 40px 20px;
        }

        .header h1 {
            font-size: 3.5rem;
            margin-bottom: 15px;
            text-shadow: 2px 2px 8px rgba(0,0,0,0.3);
            font-weight: 700;
        }

        .header .subtitle {
            font-size: 1.4rem;
            opacity: 0.95;
            margin-bottom: 10px;
            font-weight: 300;
        }

        .header .tagline {
            font-size: 1rem;
            opacity: 0.8;
            font-style: italic;
        }

        .main-card {
            background: white;
            border-radius: 20px;
            box-shadow: 0 25px 50px rgba(0,0,0,0.15);
            overflow: hidden;
            margin-bottom: 40px;
            backdrop-filter: blur(10px);
        }

        .hero-section {
            background: linear-gradient(135deg, #2E86AB, #A23B72);
            color: white;
            padding: 40px 30px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .hero-section::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: float 6s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(180deg); }
        }

        .hero-section h2 {
            font-size: 2.2rem;
            margin-bottom: 15px;
            position: relative;
            z-index: 1;
        }

        .hero-section p {
            font-size: 1.1rem;
            opacity: 0.9;
            position: relative;
            z-index: 1;
        }

        .card-body {
            padding: 40px 30px;
        }

        .section {
            margin-bottom: 40px;
            opacity: 0;
            animation: slideUp 0.6s ease-out forwards;
        }

        .section:nth-child(1) { animation-delay: 0.1s; }
        .section:nth-child(2) { animation-delay: 0.2s; }
        .section:nth-child(3) { animation-delay: 0.3s; }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .section h3 {
            font-size: 1.5rem;
            color: #2E86AB;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .query-section {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border-radius: 15px;
            padding: 30px;
            border: 1px solid #dee2e6;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);
        }

        .query-input {
            width: 100%;
            padding: 20px;
            border: 2px solid #e0e0e0;
            border-radius: 15px;
            font-size: 16px;
            resize: vertical;
            min-height: 140px;
            margin-bottom: 25px;
            transition: all 0.3s ease;
            background: white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .query-input:focus {
            outline: none;
            border-color: #2E86AB;
            box-shadow: 0 0 20px rgba(46, 134, 171, 0.1);
            transform: translateY(-2px);
        }

        .button-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
            margin-bottom: 20px;
        }

        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn-primary {
            background: linear-gradient(135deg, #2E86AB, #A23B72);
            color: white;
            box-shadow: 0 4px 15px rgba(46, 134, 171, 0.3);
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(46, 134, 171, 0.4);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #6c757d, #495057);
            color: white;
            box-shadow: 0 4px 15px rgba(108, 117, 125, 0.3);
        }

        .btn-secondary:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(108, 117, 125, 0.4);
        }

        .btn-success {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
        }

        .btn-success:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(40, 167, 69, 0.4);
        }

        .btn-info {
            background: linear-gradient(135deg, #17a2b8, #20c997);
            color: white;
            box-shadow: 0 4px 15px rgba(23, 162, 184, 0.3);
        }

        .btn-info:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(23, 162, 184, 0.4);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
        }

        .response-section {
            margin-top: 30px;
            padding: 30px;
            background: linear-gradient(135deg, #f8f9fa, #ffffff);
            border-radius: 15px;
            border-left: 5px solid #2E86AB;
            display: none;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .response-section.show {
            display: block;
            animation: slideUp 0.5s ease-out;
        }

        .response-content {
            white-space: pre-wrap;
            line-height: 1.7;
            font-size: 16px;
            color: #2c3e50;
        }

        .processing-time {
            font-size: 0.9rem;
            color: #666;
            margin-top: 15px;
            font-style: italic;
            text-align: right;
        }

        .example-queries {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 25px;
        }

        .example-query {
            background: linear-gradient(135deg, #ffffff, #f8f9fa);
            border: 2px solid #e9ecef;
            border-radius: 12px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .example-query::before {
            content: '💡';
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 1.2rem;
            opacity: 0.7;
        }

        .example-query:hover {
            background: linear-gradient(135deg, #e3f2fd, #f3e5f5);
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(46, 134, 171, 0.15);
            border-color: #2E86AB;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 40px;
            background: linear-gradient(135deg, #f8f9fa, #ffffff);
            border-radius: 15px;
            margin: 20px 0;
        }

        .loading.show {
            display: block;
            animation: slideUp 0.5s ease-out;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #2E86AB;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .alert {
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
            font-weight: 500;
            border: 1px solid transparent;
            animation: slideDown 0.3s ease-out;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .alert-error {
            background: linear-gradient(135deg, #f8d7da, #f5c6cb);
            color: #721c24;
            border-color: #f5c6cb;
        }

        .alert-success {
            background: linear-gradient(135deg, #d4edda, #c3e6cb);
            color: #155724;
            border-color: #c3e6cb;
        }

        .alert-info {
            background: linear-gradient(135deg, #d1ecf1, #bee5eb);
            color: #0c5460;
            border-color: #bee5eb;
        }

        .upload-section {
            background: linear-gradient(135deg, #e8f4fd, #d1ecf1);
            border-radius: 15px;
            padding: 25px;
            border: 2px dashed #17a2b8;
            margin-bottom: 30px;
            transition: all 0.3s ease;
        }

        .upload-section:hover {
            border-color: #138496;
            background: linear-gradient(135deg, #d1ecf1, #bee5eb);
        }

        .file-upload {
            margin: 20px 0;
        }

        .file-input {
            width: 100%;
            padding: 20px;
            border: 2px dashed #17a2b8;
            border-radius: 12px;
            background: white;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 16px;
        }

        .file-input:hover {
            background: #f8f9fa;
            border-color: #138496;
        }

        .advanced-toggle {
            text-align: center;
            margin-bottom: 20px;
        }

        .toggle-btn {
            background: none;
            border: 2px solid #6c757d;
            color: #6c757d;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        .toggle-btn:hover {
            background: #6c757d;
            color: white;
        }

        .advanced-section {
            display: none;
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            border: 1px solid #dee2e6;
        }

        .advanced-section.show {
            display: block;
            animation: slideDown 0.3s ease-out;
        }

        .footer {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            color: white;
            margin-top: 40px;
            padding: 30px;
            text-align: center;
        }

        .footer-content {
            margin-bottom: 20px;
        }

        .footer h4 {
            margin-bottom: 15px;
            font-size: 1.2rem;
        }

        .tech-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
            font-size: 0.9rem;
            opacity: 0.8;
        }

        .tech-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(255, 255, 255, 0.1);
            padding: 10px 15px;
            border-radius: 8px;
        }

        .status-badge {
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .status-ready {
            background: rgba(40, 167, 69, 0.8);
            color: white;
        }

        .status-not-ready {
            background: rgba(220, 53, 69, 0.8);
            color: white;
        }

        .status-warning {
            background: rgba(255, 193, 7, 0.8);
            color: #212529;
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }

            .header h1 {
                font-size: 2.5rem;
            }

            .hero-section h2 {
                font-size: 1.8rem;
            }

            .card-body {
                padding: 25px 20px;
            }

            .button-group {
                flex-direction: column;
            }

            .btn {
                width: 100%;
                justify-content: center;
            }

            .tech-details {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 480px) {
            .header {
                padding: 20px 10px;
            }

            .header h1 {
                font-size: 2rem;
            }

            .main-card {
                border-radius: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🎓 StepBeyond</h1>
            <p class="subtitle">Your AI-Powered Study Abroad Counselor</p>
            <p class="tagline">Empowering dreams, guiding futures</p>
        </div>

        <div class="main-card">
            <div class="hero-section">
                <h2>Get Personalized Guidance</h2>
                <p>Ask me anything about studying abroad - from university applications to visa requirements</p>
            </div>

            <div class="card-body">
                <!-- Main Query Section -->
                <div class="section query-section">
                    <h3>💬 What can I help you with today?</h3>
                    <textarea 
                        id="queryInput" 
                        class="query-input" 
                        placeholder="Ask me about:
• University applications and requirements
• Student visa processes and documentation  
• Scholarship opportunities and funding
• Country-specific study abroad information
• Career guidance and course selection

Type your question here..."
                    ></textarea>
                    
                    <div class="button-group">
                        <button class="btn btn-primary" onclick="processQuery()">
                            🎯 Get Expert Guidance
                        </button>
                        <button class="btn btn-secondary" onclick="getQuickAnswer()">
                            ⚡ Quick Answer
                        </button>
                    </div>
                </div>

                <!-- Advanced Options Toggle -->
                <div class="advanced-toggle">
                    <button class="toggle-btn" onclick="toggleAdvanced()">
                        📚 Upload Documents (Optional)
                    </button>
                </div>

                <!-- Advanced Section (Hidden by default) -->
                <div id="advancedSection" class="advanced-section">
                    <div class="upload-section">
                        <h3>📁 Upload Additional Documents</h3>
                        <p>Upload PDF, TXT, or DOCX files to enhance my knowledge base</p>
                        
                        <div class="file-upload">
                            <input type="file" id="fileInput" multiple accept=".pdf,.txt,.docx" class="file-input" onchange="handleFileSelect()" placeholder="Click here to select files or drag and drop">
                            <div id="selectedFiles"></div>
                        </div>
                        
                        <div class="button-group">
                            <button class="btn btn-info" onclick="uploadDocuments()" id="uploadBtn" disabled>
                                📚 Process Documents
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Loading -->
                <div id="loading" class="loading">
                    <div class="spinner"></div>
                    <p>🤔 Processing your question... This may take a moment.</p>
                </div>

                <!-- Response Section -->
                <div id="responseSection" class="response-section">
                    <h3>🎯 Your Personalized Guidance:</h3>
                    <div id="responseContent" class="response-content"></div>
                    <div id="processingTime" class="processing-time"></div>
                </div>

                <!-- Example Queries -->
                <div class="section">
                    <h3>💡 Popular Questions About Canada</h3>
                    <div id="exampleQueries" class="example-queries">
                        <!-- Will be populated by JavaScript -->
                    </div>
                </div>
            </div>
        </div>

        <div class="footer">
            <div class="footer-content">
                <h4>🚀 StepBeyond v2.0</h4>
                <p>Built with cutting-edge AI technology to provide you with the most accurate and up-to-date guidance for studying in Canada</p>
                
                <div id="systemStatusIndicator" style="margin-top: 20px;">
                    <div style="display: flex; align-items: center; justify-content: center; gap: 10px;">
                        <span>System Status:</span>
                        <span id="overallStatus" class="status-badge status-not-ready">Checking...</span>
                    </div>
                </div>
                
                <!-- Technical Details - Only shown on errors -->
                <div id="technicalDetails" style="display: none; margin-top: 20px; padding: 20px; background: rgba(255,255,255,0.1); border-radius: 10px;">
                    <h5 style="margin-bottom: 15px; color: #fff;">Technical Details:</h5>
                    <div class="tech-details">
                        <div class="tech-item">
                            <span>API Status:</span>
                            <span id="apiStatus" class="status-badge status-not-ready">Checking...</span>
                        </div>
                        <div class="tech-item">
                            <span>Vector Database:</span>
                            <span id="qdrantStatus" class="status-badge status-not-ready">Not Ready</span>
                        </div>
                        <div class="tech-item">
                            <span>Knowledge Base:</span>
                            <span id="ragStatus" class="status-badge status-not-ready">Not Ready</span>
                        </div>
                        <div class="tech-item">
                            <span>AI Agent:</span>
                            <span id="agentStatus" class="status-badge status-not-ready">Not Ready</span>
                        </div>
                    </div>
                    
                    <div style="margin-top: 15px;">
                        <button class="btn btn-success" onclick="initializeSystem()" style="margin-right: 10px;">
                            🚀 Retry Initialize
                        </button>
                        <button class="btn btn-secondary" onclick="checkStatus()">
                            🔄 Refresh Status
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Configuration
        const API_BASE_URL = window.location.origin;
        
        // State
        let systemInitialized = false;
        let selectedFiles = [];
        let advancedVisible = false;

        // Initialize on page load
        window.addEventListener('DOMContentLoaded', function() {
            console.log('API Base URL:', API_BASE_URL);
            checkStatus();
            loadExampleQueries();
        });

        // Toggle advanced section
        function toggleAdvanced() {
            const section = document.getElementById('advancedSection');
            const btn = document.querySelector('.toggle-btn');
            
            advancedVisible = !advancedVisible;
            
            if (advancedVisible) {
                section.classList.add('show');
                btn.textContent = '📚 Hide Upload Section';
                btn.style.background = '#17a2b8';
                btn.style.color = 'white';
                btn.style.borderColor = '#17a2b8';
            } else {
                section.classList.remove('show');
                btn.textContent = '📚 Upload Documents (Optional)';
                btn.style.background = 'none';
                btn.style.color = '#6c757d';
                btn.style.borderColor = '#6c757d';
            }
        }

        // API calling functions with better error handling
        async function apiCall(endpoint, method = 'GET', data = null, isFormData = false) {
            const url = `${API_BASE_URL}${endpoint}`;
            console.log(`Making API call: ${method} ${url}`);
            
            const options = {
                method: method,
            };

            if (!isFormData) {
                options.headers = {
                    'Content-Type': 'application/json',
                };
            }

            if (data) {
                options.body = isFormData ? data : JSON.stringify(data);
            }

            try {
                const response = await fetch(url, options);
                console.log(`Response status: ${response.status}`);
                
                // Check if response is JSON
                const contentType = response.headers.get('content-type');
                if (!contentType || !contentType.includes('application/json')) {
                    const text = await response.text();
                    console.error('Non-JSON response:', text.substring(0, 200));
                    throw new Error('Server returned non-JSON response. Please try refreshing the page.');
                }
                
                const result = await response.json();
                
                if (!response.ok) {
                    throw new Error(result.detail || `HTTP ${response.status}: ${response.statusText}`);
                }
                
                return result;
            } catch (error) {
                console.error('API call failed:', error);
                throw error;
            }
        }

        // File handling
        function handleFileSelect() {
            const fileInput = document.getElementById('fileInput');
            const selectedFilesDiv = document.getElementById('selectedFiles');
            const uploadBtn = document.getElementById('uploadBtn');
            
            selectedFiles = Array.from(fileInput.files);
            
            if (selectedFiles.length > 0) {
                selectedFilesDiv.innerHTML = `
                    <div class="alert alert-info">
                        <strong>✅ Selected ${selectedFiles.length} file(s):</strong><br>
                        ${selectedFiles.map(f => f.name).join(', ')}
                    </div>
                `;
                uploadBtn.disabled = false;
            } else {
                selectedFilesDiv.innerHTML = '';
                uploadBtn.disabled = true;
            }
        }

        // Upload documents
        async function uploadDocuments() {
            if (selectedFiles.length === 0) {
                showAlert('Please select files to upload first! 📁', 'error');
                return;
            }

            try {
                showLoading(true);
                
                const formData = new FormData();
                selectedFiles.forEach(file => {
                    formData.append('files', file);
                });
                
                const result = await apiCall('/upload-documents', 'POST', formData, true);
                
                if (result.success) {
                    showAlert(`✅ Great! Your documents have been processed successfully!<br>📄 Documents processed: ${result.documents_processed}<br>📊 Knowledge chunks created: ${result.total_chunks}`, 'success');
                    
                    // Clear file selection
                    document.getElementById('fileInput').value = '';
                    document.getElementById('selectedFiles').innerHTML = '';
                    document.getElementById('uploadBtn').disabled = true;
                    selectedFiles = [];
                    
                    // Refresh status
                    checkStatus();
                } else {
                    showAlert('❌ ' + result.message, 'error');
                }
            } catch (error) {
                showAlert('❌ Failed to upload documents: ' + error.message, 'error');
            } finally {
                showLoading(false);
            }
        }

        // Status check with simplified UI
        async function checkStatus() {
            const overallStatusEl = document.getElementById('overallStatus');
            const technicalDetailsEl = document.getElementById('technicalDetails');
            
            try {
                // First check if API is responsive
                console.log('Checking API health...');
                await apiCall('/api/health');
                document.getElementById('apiStatus').textContent = 'Connected';
                document.getElementById('apiStatus').className = 'status-badge status-ready';

                // Get detailed status
                console.log('Getting detailed status...');
                const status = await apiCall('/status');
                console.log('Status response:', status);
                
                // Update individual status indicators (for technical details)
                updateIndividualStatuses(status);
                
                // Determine overall system status
                const allReady = status.qdrant_configured && 
                                (status.rag_status === 'ready' || status.rag_status === 'connected_empty') && 
                                status.agent_status === 'ready';
                
                if (allReady) {
                    overallStatusEl.textContent = '✅ System Ready';
                    overallStatusEl.className = 'status-badge status-ready';
                    systemInitialized = true;
                    technicalDetailsEl.style.display = 'none';
                } else {
                    overallStatusEl.textContent = '⚠️ System Initializing...';
                    overallStatusEl.className = 'status-badge status-warning';
                    systemInitialized = false;
                    // Auto-initialize if not ready
                    setTimeout(initializeSystem, 1000);
                }

            } catch (error) {
                console.error('Status check error:', error);
                overallStatusEl.textContent = '❌ System Error';
                overallStatusEl.className = 'status-badge status-not-ready';
                systemInitialized = false;
                
                // Show technical details on error
                technicalDetailsEl.style.display = 'block';
                document.getElementById('apiStatus').textContent = 'Error';
                document.getElementById('apiStatus').className = 'status-badge status-not-ready';
            }
        }

        // Helper function to update individual status indicators
        function updateIndividualStatuses(status) {
            // Update Qdrant status
            const qdrantStatusEl = document.getElementById('qdrantStatus');
            if (status.qdrant_configured) {
                qdrantStatusEl.textContent = 'Connected';
                qdrantStatusEl.className = 'status-badge status-ready';
            } else {
                qdrantStatusEl.textContent = 'Not Configured';
                qdrantStatusEl.className = 'status-badge status-not-ready';
            }

            // Update RAG status
            const ragStatusEl = document.getElementById('ragStatus');
            if (status.rag_status === 'ready') {
                ragStatusEl.textContent = `Ready (${status.rag_documents} docs)`;
                ragStatusEl.className = 'status-badge status-ready';
            } else if (status.rag_status === 'connected_empty') {
                ragStatusEl.textContent = 'Connected (Empty)';
                ragStatusEl.className = 'status-badge status-warning';
            } else {
                ragStatusEl.textContent = 'Not Ready';
                ragStatusEl.className = 'status-badge status-not-ready';
            }

            // Update Agent status
            const agentStatusEl = document.getElementById('agentStatus');
            if (status.agent_status === 'ready') {
                agentStatusEl.textContent = 'Ready';
                agentStatusEl.className = 'status-badge status-ready';
            } else {
                agentStatusEl.textContent = 'Not Ready';
                agentStatusEl.className = 'status-badge status-not-ready';
            }
        }

        // Initialize system with simplified UI
        async function initializeSystem() {
            const overallStatusEl = document.getElementById('overallStatus');
            const technicalDetailsEl = document.getElementById('technicalDetails');
            
            try {
                overallStatusEl.textContent = '⚙️ Initializing...';
                overallStatusEl.className = 'status-badge status-warning';
                
                console.log('Initializing system...');
                const result = await apiCall('/initialize', 'POST');
                console.log('Initialize response:', result);
                
                if (result.success) {
                    overallStatusEl.textContent = '✅ System Ready';
                    overallStatusEl.className = 'status-badge status-ready';
                    systemInitialized = true;
                    technicalDetailsEl.style.display = 'none';
                    
                    // Subtle success indication without intrusive alert
                    console.log(`System initialized successfully. Documents: ${result.documents_count}`);
                } else {
                    throw new Error(result.message || 'Initialization failed');
                }
            } catch (error) {
                console.error('Initialize error:', error);
                overallStatusEl.textContent = '❌ System Error';
                overallStatusEl.className = 'status-badge status-not-ready';
                systemInitialized = false;
                
                // Show technical details on error
                technicalDetailsEl.style.display = 'block';
                
                // Only show user-facing error for critical issues
                if (error.message.includes('non-JSON response') || error.message.includes('Server')) {
                    showAlert('🔧 System is starting up. Please wait a moment and try again.', 'info');
                } else {
                    showAlert('❌ Unable to initialize system. Please check your connection and try again.', 'error');
                }
            }
        }

        // Process query
        async function processQuery() {
            const query = document.getElementById('queryInput').value.trim();
            
            if (!query) {
                showAlert('Please enter your question first! 💬', 'error');
                return;
            }

            if (!systemInitialized) {
                showAlert('🚀 System needs to be initialized first. Please click "Initialize System" in the footer.', 'error');
                return;
            }

                            try {
                showLoading(true);
                hideResponse();
                
                const result = await apiCall('/query', 'POST', { query: query });
                
                if (result.success) {
                    showResponse(result.response, result.processing_time);
                } else {
                    showAlert('❌ ' + (result.error || 'Failed to process query'), 'error');
                }
            } catch (error) {
                showAlert('❌ Failed to process query: ' + error.message, 'error');
            } finally {
                showLoading(false);
            }
        }

        // Get quick answer
        async function getQuickAnswer() {
            const query = document.getElementById('queryInput').value.trim();
            
            if (!query) {
                showAlert('Please enter your question first! 💬', 'error');
                return;
            }

            if (!systemInitialized) {
                showAlert('🚀 System needs to be initialized first. Please click "Initialize System" in the footer.', 'error');
                return;
            }

            try {
                showLoading(true);
                hideResponse();
                
                const result = await apiCall('/quick-answer', 'POST', { query: query });
                
                if (result.success) {
                    showResponse(result.response, result.processing_time);
                } else {
                    showAlert('❌ ' + (result.error || 'Failed to get quick answer'), 'error');
                }
            } catch (error) {
                showAlert('❌ Failed to get quick answer: ' + error.message, 'error');
            } finally {
                showLoading(false);
            }
        }

        // Load example queries
        async function loadExampleQueries() {
            // Canada-focused example queries since it's the currently supported country
            const canadaFocusedExamples = [
                "What are the requirements for a Canadian student visa?",
                "How do I apply for universities in Canada?",
                "What scholarships are available for Indian students in Canada?",
                "Which Canadian provinces are best for international students?",
                "What is the cost of studying in Canada?",
                "How do I prepare for studying in Canada?",
                "What are the top universities in Canada for engineering?",
                "How can I get a study permit for Canada?",
                "What are the job opportunities for students in Canada?"
            ];
            
            const container = document.getElementById('exampleQueries');
            
            // Try to load from API first, but use Canada-focused fallback
            try {
                const result = await apiCall('/example-queries');
                if (result.examples && result.examples.length > 0) {
                    container.innerHTML = result.examples.map(example => 
                        `<div class="example-query" onclick="setQuery('${example.replace(/'/g, "\\'")}')">${example}</div>`
                    ).join('');
                } else {
                    throw new Error('No examples returned from API');
                }
            } catch (error) {
                console.log('Using Canada-focused example queries');
                // Use Canada-focused fallback examples
                container.innerHTML = canadaFocusedExamples.map(example => 
                    `<div class="example-query" onclick="setQuery('${example}')">${example}</div>`
                ).join('');
            }
        }

        // Set query from example
        function setQuery(query) {
            document.getElementById('queryInput').value = query;
            document.getElementById('queryInput').focus();
            document.getElementById('queryInput').scrollIntoView({ behavior: 'smooth', block: 'center' });
        }

        // UI helper functions
        function showLoading(show) {
            const loadingEl = document.getElementById('loading');
            if (show) {
                loadingEl.classList.add('show');
            } else {
                loadingEl.classList.remove('show');
            }
        }

        function showResponse(content, processingTime) {
            const responseSection = document.getElementById('responseSection');
            const responseContent = document.getElementById('responseContent');
            const processingTimeEl = document.getElementById('processingTime');
            
            responseContent.textContent = content;
            processingTimeEl.textContent = `⏱️ Response generated in ${processingTime.toFixed(2)} seconds`;
            
            responseSection.classList.add('show');
            responseSection.scrollIntoView({ behavior: 'smooth' });
        }

        function hideResponse() {
            document.getElementById('responseSection').classList.remove('show');
        }

        function showAlert(message, type) {
            // Remove any existing alerts
            const existingAlerts = document.querySelectorAll('.alert');
            existingAlerts.forEach(alert => alert.remove());
            
            // Create new alert element
            const alertEl = document.createElement('div');
            alertEl.className = `alert alert-${type}`;
            alertEl.innerHTML = message;
            
            // Insert after the query section
            const querySection = document.querySelector('.query-section');
            querySection.parentNode.insertBefore(alertEl, querySection.nextSibling);
            
            // Auto-scroll to alert
            setTimeout(() => {
                alertEl.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            }, 100);
            
            // Remove alert after 8 seconds
            setTimeout(() => {
                if (alertEl.parentNode) {
                    alertEl.remove();
                }
            }, 8000);
        }

        // Keyboard shortcuts
        document.getElementById('queryInput').addEventListener('keydown', function(event) {
            if (event.ctrlKey && event.key === 'Enter') {
                event.preventDefault();
                processQuery();
            } else if (event.shiftKey && event.key === 'Enter') {
                event.preventDefault();
                getQuickAnswer();
            }
        });

        // Add keyboard shortcut hints
        document.getElementById('queryInput').addEventListener('focus', function() {
            const placeholder = this.getAttribute('placeholder');
            if (!placeholder.includes('Ctrl+Enter')) {
                this.setAttribute('placeholder', placeholder + '\n\n💡 Tips: Ctrl+Enter for Expert Guidance, Shift+Enter for Quick Answer');
            }
        });

        document.getElementById('queryInput').addEventListener('blur', function() {
            const originalPlaceholder = `Ask me about:
• University applications and requirements
• Student visa processes and documentation  
• Scholarship opportunities and funding
• Country-specific study abroad information
• Career guidance and course selection

Type your question here...`;
            this.setAttribute('placeholder', originalPlaceholder);
        });

        // Drag and drop file upload
        const fileInput = document.getElementById('fileInput');
        
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            fileInput.addEventListener(eventName, preventDefaults, false);
        });

        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }

        ['dragenter', 'dragover'].forEach(eventName => {
            fileInput.addEventListener(eventName, highlight, false);
        });

        ['dragleave', 'drop'].forEach(eventName => {
            fileInput.addEventListener(eventName, unhighlight, false);
        });

        function highlight(e) {
            fileInput.style.background = '#e3f2fd';
            fileInput.style.borderColor = '#1976d2';
        }

        function unhighlight(e) {
            fileInput.style.background = 'white';
            fileInput.style.borderColor = '#17a2b8';
        }

        fileInput.addEventListener('drop', handleDrop, false);

        function handleDrop(e) {
            const dt = e.dataTransfer;
            const files = dt.files;
            
            fileInput.files = files;
            handleFileSelect();
        }

        // Auto-initialize system on first query - simplified
        let autoInitTriggered = false;
        
        async function autoInitializeIfNeeded() {
            if (!systemInitialized && !autoInitTriggered) {
                autoInitTriggered = true;
                await initializeSystem();
            }
        }

        // Override the original processQuery and getQuickAnswer to include auto-init
        const originalProcessQuery = processQuery;
        const originalGetQuickAnswer = getQuickAnswer;

        processQuery = async function() {
            const query = document.getElementById('queryInput').value.trim();
            
            if (!query) {
                showAlert('Please enter your question first! 💬', 'error');
                return;
            }

            // Auto-initialize if needed
            await autoInitializeIfNeeded();
            
            if (!systemInitialized) {
                showAlert('🔧 System is still initializing. Please wait a moment and try again.', 'info');
                return;
            }

            try {
                showLoading(true);
                hideResponse();
                
                const result = await apiCall('/query', 'POST', { query: query });
                
                if (result.success) {
                    showResponse(result.response, result.processing_time);
                } else {
                    showAlert('❌ ' + (result.error || 'Failed to process query'), 'error');
                }
            } catch (error) {
                showAlert('❌ Failed to process query: ' + error.message, 'error');
            } finally {
                showLoading(false);
            }
        };

        getQuickAnswer = async function() {
            const query = document.getElementById('queryInput').value.trim();
            
            if (!query) {
                showAlert('Please enter your question first! 💬', 'error');
                return;
            }

            // Auto-initialize if needed
            await autoInitializeIfNeeded();
            
            if (!systemInitialized) {
                showAlert('🔧 System is still initializing. Please wait a moment and try again.', 'info');
                return;
            }

            try {
                showLoading(true);
                hideResponse();
                
                const result = await apiCall('/quick-answer', 'POST', { query: query });
                
                if (result.success) {
                    showResponse(result.response, result.processing_time);
                } else {
                    showAlert('❌ ' + (result.error || 'Failed to get quick answer'), 'error');
                }
            } catch (error) {
                showAlert('❌ Failed to get quick answer: ' + error.message, 'error');
            } finally {
                showLoading(false);
            }
        };
